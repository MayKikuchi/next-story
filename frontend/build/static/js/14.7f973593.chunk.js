(this["webpackJsonpnext-story"]=this["webpackJsonpnext-story"]||[]).push([[14],{158:function(e,t,n){"use strict";var r=n(23),a=n(0),c=n.n(a),o=n(141),i=n(18);function u(){var e=Object(r.a)(["\n    margin-top: 85px;\n    margin-bottom: 85px;\n"]);return u=function(){return e},e}var s=Object(i.b)(o.a)(u());t.a=function(e){return c.a.createElement(s,{maxWidth:e.maxWidth},e.children)}},162:function(e,t,n){"use strict";var r,a;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),function(e){e.movie="movie",e.book="book",e.start=""}(r||(r={})),function(e){e.person="person",e.genre="genre",e.tag="tag",e.searchBar="searchBar"}(a||(a={}))},167:function(e,t,n){"use strict";var r=n(23),a=n(0),c=n.n(a),o=n(18),i=n(9);function u(){var e=Object(r.a)(["\n    border-radius: 7px;\n    color: white;\n    outline: none;\n    border: none;\n    margin: 5px;\n    cursor: pointer;\n    background-color: ",";\n    &:hover {\n        background-color: ",";\n    }\n    font-size: 16px;\n    padding: 3px 5px 3px 5px;\n"]);return u=function(){return e},e}var s=o.b.button(u(),(function(e){return e.theme.palette.primary.light}),(function(e){return e.theme.palette.secondary.light})),l=function(e){var t=e.label,n=e.tagId,r=e.singleQueryType,a=Object(i.g)();return c.a.createElement(c.a.Fragment,null,t&&c.a.createElement(s,{onClick:function(){a.push("/searchResult/param?singleQueryType=".concat(r,"&query=").concat(n||t))}},t))};function g(){var e=Object(r.a)(["\n    margin-bottom: 15px;\n"]);return g=function(){return e},e}var b=o.b.div(g());t.a=function(e){var t=e.singleQueryType,n=e.tags,r=e.tagObjects;return c.a.createElement(b,null,n&&n.map((function(e,n){return c.a.createElement(l,{key:n,label:e,singleQueryType:t})})),!n&&r&&r.map((function(e,n){return c.a.createElement(l,{key:n,label:e.tagName,singleQueryType:t,tagId:e.tagId})})))}},365:function(e,t,n){"use strict";n.r(t);var r=n(258),a=n.n(r),c=n(62),o=n(260),i=n(36),u=n(0),s=n.n(u),l=n(158),g=n(143),b=n(159),m=n.n(b),p=n(162),f=n(177),h=n(23),d=n(18),v=n(261),x=n(145),y=n(253),O=n(167),j=n(9);function k(){var e=Object(h.a)(["\n    &:hover {\n        cursor: pointer;\n    }\n"]);return k=function(){return e},e}function E(){var e=Object(h.a)(["\n    margin-bottom: 5px;\n"]);return E=function(){return e},e}function T(){var e=Object(h.a)(["\n    max-width: ",";\n    &:hover {\n        cursor: pointer;\n    }\n"]);return T=function(){return e},e}function w(){var e=Object(h.a)(["\n    display: flex;\n    justify-content: space-between;\n"]);return w=function(){return e},e}function S(){var e=Object(h.a)(["\n    border-top: ",";\n    border-bottom: ",";\n    min-height: 50px;\n    padding: 5px;\n    margin-bottom: 2px;\n"]);return S=function(){return e},e}var I=d.b.div(S(),(function(e){var t=e.theme;return"2px solid ".concat(t.palette.grey[400])}),(function(e){var t=e.theme;return"2px solid ".concat(t.palette.grey[400])})),B=d.b.div(w()),M=d.b.img(T(),(function(e){return e.isSmall?"150px":"100%"})),Q=d.b.div(E()),A=Object(d.b)(v.a)(k()),P=function(e){var t=e.image,n=e.title,r=e.blurb,a=e.genres,c=e.mediaType,o=e.mediaId,i=e.nextStoryTags,u=Object(j.g)(),l=Object(x.a)("(max-width:450px)"),g=function(){u.push("/".concat(c,"/").concat(o))};return s.a.createElement(I,null,s.a.createElement(B,null,s.a.createElement(y.a,{container:!0,direction:"row",spacing:5},s.a.createElement(y.a,{item:!0,sm:3},s.a.createElement(M,{src:t,onClick:g,isSmall:l})),s.a.createElement(y.a,{item:!0,sm:6},s.a.createElement(Q,null,s.a.createElement(A,{variant:"h5",onClick:g,color:"textPrimary",gutterBottom:!0},s.a.createElement("strong",null,n))),r),s.a.createElement(y.a,{item:!0,sm:3},"Genres:",s.a.createElement(O.a,{tags:a,singleQueryType:p.b.genre}),i&&s.a.createElement(s.a.Fragment,null,"Tags:",s.a.createElement(O.a,{tagObjects:i,singleQueryType:p.b.tag}))))))},N=function(e){var t=e.resultsToDisplay,n=e.hasMore,r=e.doNext;return s.a.createElement(f.a,{style:{overflow:"hidden"},dataLength:t.length,scrollThreshold:1,next:r,hasMore:n,loader:s.a.createElement("h4",{style:{textAlign:"center"}},"Loading more results..."),endMessage:s.a.createElement("p",{style:{textAlign:"center"}},s.a.createElement("b",null,"No more results"))},t.map((function(e,t){return s.a.createElement(P,{key:t,image:e.image,title:e.title,blurb:e.blurb,genres:e.genres,nextStoryTags:e.nextStoryTags,mediaType:e.mediaType,mediaId:e.id})})))};t.default=function(e){var t=function(e){var t=e.substr(1).split("&"),n=Object(i.a)(t,2),r=n[0],a=n[1];return[r.split("=")[1],a.split("=")[1]]}(decodeURI(e.location.search)),n=Object(i.a)(t,2),r=n[0],b=n[1],f=Object(u.useState)(0),h=Object(i.a)(f,2),d=h[0],v=h[1],x=Object(u.useState)([]),y=Object(i.a)(x,2),O=y[0],j=y[1],k=Object(u.useState)([]),E=Object(i.a)(k,2),T=E[0],w=E[1],S=Object(u.useState)([]),I=Object(i.a)(S,2),B=I[0],M=I[1],Q=Object(u.useState)("all"),A=Object(i.a)(Q,2),P=A[0],C=(A[1],Object(u.useState)(!0)),R=Object(i.a)(C,2),W=R[0],D=R[1],F=Object(u.useState)(!0),J=Object(i.a)(F,2),L=J[0],Y=J[1];function q(){return(q=Object(o.a)(a.a.mark((function e(){var t,n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],e.prev=2,e.next=5,m.a.get("/movies/withTag/".concat(b));case 5:r=e.sent,t=r.data,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("error fetching movies from mongo for tag",e.t0);case 12:return e.prev=12,e.next=15,m.a.get("/books/withTag/".concat(b));case 15:c=e.sent,n=c.data,e.next=22;break;case 19:e.prev=19,e.t1=e.catch(12),console.log("error fetching movies from mongo for tag",e.t1);case 22:return e.abrupt("return",[t,n]);case 23:case"end":return e.stop()}}),e,null,[[2,9],[12,19]])})))).apply(this,arguments)}function z(){return(z=Object(o.a)(a.a.mark((function e(t,n){var r,o,i,u,s,l,g,b,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],o=[],i=d+5,u=t.length>=i?i:t.length,s=n.length>=i?i:n.length,l=a.a.mark((function e(n){var r,i,u,s,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n].movieId,e.prev=1,e.next=4,m.a.get("/thirdPartyMovieApi/tmdbMovies/searchOneById/".concat(r));case 4:i=e.sent,u=i.data,s=t.filter((function(e){return e.movieId===r})),l=s.length>0&&s[0],u.nextStoryTags=l?l.nextStoryTags:[],o.push(u),M((function(e){return[].concat(Object(c.a)(e),[u])})),j((function(e){return[].concat(Object(c.a)(e),[u])})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})),g=d;case 7:if(!(g<u)){e.next=12;break}return e.delegateYield(l(g),"t0",9);case 9:g++,e.next=7;break;case 12:b=a.a.mark((function e(t){var o,i,u,s,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n[t].bookId,e.prev=1,e.next=4,m.a.get("/thirdPartyBookApi/googleBooks/searchOneById/".concat(o));case 4:i=e.sent,u=i.data,s=n.filter((function(e){return e.bookId===o})),l=s.length>0&&s[0],u.nextStoryTags=l?l.nextStoryTags:[],r.push(u),M((function(e){return[].concat(Object(c.a)(e),[u])})),w((function(e){return[].concat(Object(c.a)(e),[u])})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})),p=d;case 14:if(!(p<s)){e.next=19;break}return e.delegateYield(b(p),"t1",16);case 16:p++,e.next=14;break;case 19:return 0===o.length&&D(!1),0===r.length&&Y(!1),e.abrupt("return",[o,r]);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(u.useEffect)((function(){switch(r){case p.b.tag:(function(){return q.apply(this,arguments)})().then((function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];console.log("mongo movies and books:",e),function(e,t){return z.apply(this,arguments)}(n,r).then((function(e){console.log(e);var t=Object(i.a)(e,2),n=t[0],r=t[1];j(n),w(r)})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}));break;case p.b.searchBar:case p.b.genre:case p.b.person:m.a.get("/thirdPartyMovieApi/tmdbMovies/singleQuery/".concat(r,"/").concat(b,"/").concat(d,"/").concat(5)).then((function(e){var t=e.data;console.log(t),0===t.length?D(!1):j(t),m.a.get("/thirdPartyBookApi/googleBooks/singleQuery/".concat(r,"/").concat(b,"/").concat(d,"/").concat(5)).then((function(e){var n=e.data;console.log(n),0===n.length?Y(!1):(w(n),M((function(e){return[].concat(Object(c.a)(e),Object(c.a)(t),Object(c.a)(n))})))})).catch((function(e){console.log("Error getting third party books",e)}))})).catch((function(e){console.log("Error getting third party movies",e)}))}}),[r,b,d]);var G=Object(u.useMemo)((function(){switch(P){case"movies":return O;case"books":return T;case"all":default:return B}}),[P,O,T,B]);return s.a.createElement(l.a,{maxWidth:"md"},s.a.createElement(g.a,{variant:"h1"},"Search Results"),s.a.createElement("br",null),s.a.createElement(N,{resultsToDisplay:G,hasMore:W||L,doNext:function(){console.log("set next"),v(d+5)}}))}}}]);
//# sourceMappingURL=14.7f973593.chunk.js.map